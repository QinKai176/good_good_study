## 分布式事务

### 2.两阶段提交

准备阶段 - > 提交/回滚阶段

可能出现的问题：

a.**协调者故障分析**,单点故障

b.**同步阻塞协议**



2.1 同步阻塞 所有事务参与者在等待其它参与者响应的时候都处于同步阻塞状态，无法进行其它操作。

2.2 单点问题 协调者在 2PC 中起到非常大的作用，发生故障将会造成很大影响。特别是在阶段二发生故障，所有参与者会一直等待状态，无法完成其它操作。

2.3 数据不一致 在阶段二，如果协调者只发送了部分 Commit 消息，此时网络发生异常，那么只有部分参与者接收到 Commit 消息，也就是说只有部分参与者提交了事务，使得系统数据不一致。

2.4 太过保守 任意一个节点失败就会导致整个事务失败，没有完善的容错机制。





### 3.三阶段提交 

改进：**参与者中也引入了超时机制**，并且**新增了一个阶段**使得参与者可以利用这一个阶段统一各自的状态

**准备阶段、预提交阶段和提交阶段**  CanCommit、PreCommit 和 DoCommit

所以 2PC 和 3PC 都不能保证数据100%一致，因此一般都需要有定时扫描补偿机制。



### 4.补偿机制

Try - Confirm - Cancel

撤销和确认操作的执行可能需要重试，因此还需要保证**操作的幂等**。
代码复杂；

https://github.com/liuyangming/ByteTCC



